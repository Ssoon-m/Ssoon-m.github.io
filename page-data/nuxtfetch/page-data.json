{"componentChunkName":"component---src-templates-post-template-tsx","path":"/nuxtfetch/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<blockquote>\n<p>출처 : <a href=\"https://nuxtjs.org/docs/concepts/nuxt-lifecycle#nuxt-lifecycle\" target=\"_blank\" rel=\"nofollow\">https://nuxtjs.org/docs/concepts/nuxt-lifecycle#nuxt-lifecycle</a></p>\n</blockquote>\n<ul>\n<li>주의점에 대해 설명하기에 앞서 라이프 사이클 먼저 알아보자.</li>\n<li><code class=\"language-text\">nuxt</code> 를 해본 사람이라면 잘 아는 <code class=\"language-text\">nuxt</code> 라이프사이클 훅 흐름도이다.</li>\n</ul>\n<h2>✏️ SSR 동작시</h2>\n<hr>\n<p>1.nuxtServerInit\n2.plugins\n3.middleware\n4.asyncData\n5.beforeCreate\n6.created\n7.fetch\n8.plugins\n9.beforeCreate\n10.created\n11.beforeMount\n12.mounted</p>\n<h2>✏️CSR 동작시</h2>\n<hr>\n<p>1.middleware\n2.asyncData\n3.beforeCreate\n4.created\n5.fetch\n6.beforeMount\n7.mounted</p>\n<hr>\n<blockquote>\n<p>** 문제!! **</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">async</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'1. fetch start'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">dataFetching</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2. fetch end'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token function\">mounted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'3. mounted'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token literal-property property\">methods</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n  <span class=\"token function\">dataFetching</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res<span class=\"token punctuation\">,</span>rej</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n        <span class=\"token function\">res</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>Nuxt에서 위 코드를 실행하면 어떤 순서대로 콘솔에 찍힐까?</li>\n<li>1 -> 2 -> 3 순서대로 호출이 된다고 생각했다면, 맞기도하고 틀리기도 하다.</li>\n<li>위 문제는 <code class=\"language-text\">SSR</code> 로 동작하는지<code class=\"language-text\">CSR</code>로 동작하는지에 따라 답이 다르다.</li>\n</ul>\n<blockquote>\n<p><strong>이유는?</strong></p>\n</blockquote>\n<p>다시 한번 흐름도를 살펴보자!\n<img src=\"https://images.velog.io/images/ssoon-m/post/44ff6d95-e077-4887-9a31-0519b6d36b33/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202022-03-20%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%207.40.59.png\" alt=\"\"></p>\n<ul>\n<li><code class=\"language-text\">mounted</code>는 DOM이 렌더링되었을때 호출이 된다.</li>\n</ul>\n<h2>✏️SSR시 동작 순서</h2>\n<hr>\n<p><img src=\"https://images.velog.io/images/ssoon-m/post/acf32140-c2fd-45f6-95fc-866880219f06/image.png\" alt=\"\">\n결과 먼저 보자면, 1 -> 2-> 3 순서로 실행이 된다.\n<br></p>\n<p><strong>fetch에 대한 설명</strong></p>\n<ul>\n<li>SSR이나 CSR로 동작시 <strong>vue instance 가 생성이 된 이후</strong> fetch훅이 실행이 된다. (그래서 Nuxt2.12 이후 vue instance 속성들에 접근이 가능함. )</li>\n<li>페이지 렌더링은 fetch 훅까지 종료가 되고 서버에서 화면 구성을 마친 후 렌더링이 된다.(Nuxt는 **fetch promise가 종료될 때까지 대기한다!!! **)</li>\n<li>SSR시 <code class=\"language-text\">$fetchState.pending</code> 의 상태를 찍어 본다면 true로 나온다. CSR시엔 false가 나옴.</li>\n<li><strong>fetch는 캐싱을 지원</strong>해서 한 번 방문했던 곳에 저장이 가능 (feat. keep-alive)</li>\n<li>렌더링의 진행 상태를 제공한다. →<code class=\"language-text\">$fetchState</code>\n<ul>\n<li>fetchState 코드 예시\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">v-if</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$fetchState.pending<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Fetching 중 .... </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">v-else</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Fetching 종료</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\nexport default{\n\tasync fetch(){\n\t\tawait ~~~~~~~\n\t}\n}\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n위와 같이 상태에 따른 분기처리가 가능하다.</li>\n</ul>\n</li>\n</ul>\n<p><strong>fetch 요약</strong></p>\n<ul>\n<li>SSR로 동작시엔 fetch에 대한 라이프사이클 훅이 실행을 마칠때까지 10초가 걸리건 100초가 걸리건 상관 없이 유저 화면에 페이지가 렌더링이 되지 않을 것이다.(유저는 해당 페이지를 계속 못 보고 로딩되고 있는 화면만 보고있을 것이다.)</li>\n</ul>\n<h2>✏️CSR시 동작 순서</h2>\n<hr>\n<p><img src=\"https://images.velog.io/images/ssoon-m/post/e9d1bd20-5b93-4fd4-b0d0-531a444cf867/image.png\" alt=\"\">\n마찬가지로 결과 먼저 보자면, 1 -> 3 -> 2 로 실행이 된다.</p>\n<p><img src=\"https://images.velog.io/images/ssoon-m/post/d68e5b08-703e-41eb-9fd4-3e4fdafa9b2f/image.png\" alt=\"\"></p>\n<blockquote>\n<p>출처 : <a href=\"https://nuxtjs.org/docs/components-glossary/fetch/\" target=\"_blank\" rel=\"nofollow\">https://nuxtjs.org/docs/components-glossary/fetch/</a></p>\n</blockquote>\n<ul>\n<li>Nuxt 공식문서의 설명을 보면 이유를 알수있다.</li>\n<li>첫 페이지 진입시엔 서버 측에서, 라우터로 이동할때는 <strong>클라이언트 측에서 fetch가 호출</strong>된다고 한다.</li>\n<li>그렇다는건 CSR로 동작시에 fetch 훅이 비동기로 데이터를 가져오는 동안 <strong>DOM이 렌더링되었다면 mounted 훅이 동작을 하는 것이다.</strong></li>\n<li><strong>위의 라이프 사이클 훅 흐름도를 다시 살펴보면 mounted() 후에 fetch complete가 되는걸 알 수 있다.</strong></li>\n</ul>\n<h2>⭐️ 결론</h2>\n<hr>\n<ul>\n<li><strong>fetch</strong>는 asyncData에 비해 기능이 많고 모든 컴포넌트에서 사용이 가능해서 <strong>매력적인 훅이라고 생각한다.</strong></li>\n<li>fetch에 대한 글들을 읽어보면 데이터를 스토어에 넣기위해서 사용한다는 글 들이 많다.</li>\n<li>나는 컴포넌트 렌더링 이전에 비동기 로직을 호출 하는게 포인트라고 생각했지만, <strong>CSR시 컴포넌트가 렌더링이 된 후에도 데이터를 다 못 가지고 오는 경우도 있으므로</strong> 이 점은 잘 알아두고 사용해야 할 것 같다.</li>\n<li>만약 무조건 mounted이후 <strong>완벽히 바인딩된 데이터</strong>를 보여줘야 한다면? SSR이나 CSR상관없이 똑같은 순서를 보장받고 싶고 비동기 로직을 호출을 해야 한다면, <code class=\"language-text\">asyncData</code>를 사용하면 된다.</li>\n</ul>\n<p><code class=\"language-text\">asyncData</code></p>\n<ul>\n<li>페이지 컴포넌트에만 제공되는 속성.</li>\n<li>마치 뷰 라우터 네비게이션 가드에서 데이터를 호출하고 받아왔을 때 페이지를 진입하는 것과 같음.</li>\n<li>asyncData도 마찬가지로 promise가 처리될 때까지 기다린다</li>\n</ul>\n<blockquote>\n<p>TMI : Fetch vs AsyncData?.\n<img src=\"https://images.velog.io/images/ssoon-m/post/cdda2492-9479-4122-a8fc-8d273fa23a62/image.png\" alt=\"\"></p>\n</blockquote>\n<h2>🚀 마지막 퀴즈</h2>\n<hr>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">async</span> <span class=\"token function\">asyncData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'1. async start'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2. async end'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token keyword\">async</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'3. fetch start'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'4. fetch end'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token function\">mounted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'5. mounted'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>위 코드는 SSR과 CSR동작시 어떤 순서로 실행이 될까?\n<ul>\n<li><code class=\"language-text\">SSR</code> : 1(async start) → 2(async end) → 3 → 4 → 5\n<code class=\"language-text\">CSR</code> : 1(async start) → 2(async end) → 3 → 5 → 4</li>\n</ul>\n</li>\n</ul>\n<h2>참고자료</h2>\n<p>🔗 <a href=\"https://joshua1988.github.io/vue-camp/nuxt/data-fetching.html#asyncdata%EC%9D%98-%EC%97%90%EB%9F%AC-%ED%95%B8%EB%93%A4%EB%A7%81\" target=\"_blank\" rel=\"nofollow\">Nuxt의 비동기 데이터 호출 방법</a>\n🔗 <a href=\"https://nuxtjs.org/docs/features/data-fetching/#async-data\" target=\"_blank\" rel=\"nofollow\">Nuxt공식 문서 Data Fetcing 설명</a>\n🔗 <a href=\"https://dev.to/aiarnob/nuxt-js-data-fetching-hook-async-data-o9p\" target=\"_blank\" rel=\"nofollow\">Nuxt Async Data 블로그 글</a>\n🔗 <a href=\"https://www.telerik.com/blogs/understanding-difference-between-asyncdata-fetch-nuxt\" target=\"_blank\" rel=\"nofollow\">Between Asyncdata and Fetch in Nuxt</a></p>","frontmatter":{"title":"[Nuxt] fetch 훅 사용시 주의점","summary":"nuxt로 개발을 할때 fetch는 매우 매력적인 훅이다. 하지만, 정확하게 알고 사용하는건 매우 중요하므로 제대로 알아보도록 하자!","date":"2022.03.20.","categories":["nuxt","vue"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAIAAADuuAg3AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEDUlEQVQ4y32U2YocVRzG+1F8GvEVJI+Qa0GvRBFB8Am8EYMXigYvjGCCCyRjeibR2ZOerpqqruqufTv7vpRUd5iZjIkfVRyo4neW7/y//ywB/M+oi3s+T8FeMpyW+Pewm6dwvCHvPeecMibkVkppJpzUM054V0MEaN9h0BNIJRRmINxIbozyW9J7PwCw2WRJmqbr9WUc9Xk1KjMzxlDGlTbjOBqlnHXjODYDOgzXRTvcWl8IwbmglCk1zTvz2x9K6yheHR2fLC6WGKOvz4b371/8sISU0JdR8TIu46Qqi1Yqc3O62W6QUsarCZ7vH/R9d++4vPPtwY8vW015l7VDBzkXTkjv/JWu4XEcnXOMUkqos9Z5r4ydtjr68U3aslvYGMMYc84TrhhXUumvTrq7D5b3l8Aq1begA6TuUdXCsoVZDaoOXa8cBOHBwbMoTk+DbP8kbAd895fwnU8ffPgoMIjJOE83TZBW8aYJ02oR5cfLNWXyFTwAsN5sEEJuHJm0zo1I2ppp40er7aiNUkZqI5URSlEhCROUy9fOnOdFsAzAUIwuf7Jqvjsu93NihKIt1M4pbczWhdtu7w5QluViuWrXj+uTz794+Md7986+nGfNgJerMlzXSd5Cwm+Y/brb49ZYySrRzNdDe1yJXlhjnXXubZ5P8G4+C4kzVitVlxVH0GtRF3mSJAAMGOMgDC4vIwjRxaQlpWyCpTZx1lzExXmYSSGer/uPfj755OGLoKObPF9lOWaibZrFMlgEl1XTR0kahqExU6nNtLGEy7wGq7wbjX6c4js/BR88ik9ryhnFlPVsqnvExOUqiaKoBdeBmzGjKoqg5MpZ4ywUak0UlHpgQhjLteVaM2MrgF6cnx8dHYZxLKxVkxtu5rxTdsKIkFkzVD1EmHQQNwAPmDYDaiAue0CEQkxgLhATylpt7QRf7UEIhQinVAiu0rp7enoRF/X4v7qGsxrEWRNnTQvIWVr++vzsdJXfzsPu8f4axsptWoARvLpPL/HIG6+x19xrMio8ajZ9tGK0+rWVERPH54vDfw7btpuuXZtVjw7jVVT3VgmnmJVYUeg1FRRJTqaquYIppXEULaP1clVsyn6A9LN58+43Jx/vVVG8WgZhUdaLizDLiyd/PX0630+S9BqGECXJmgs9YJYW3QDJbxH4/qx+toZZ1WZFRQjd9YmqqsqyghA5527V9qimZih2HRYAxBgXyhAuqZBSGaW03bZH7/2rCtttHxK2iIok78K0xpidJ/mDvb+PgmSKipIDRoQJTBgAAGNCKJXyRp6VNphOEcdUKGOTuj+NN5t2cP+Jk3/jPV/JWtsQlMC+JLCjpCG4ZaTjtGEESYGUuA17P+4Cbq3FWwEEIZxeKcTbKuxfjNspx0878z8AAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/502c62def1d22c8851dd9e9b51e9bae4/1bb5f/nuxtfetch.png","srcSet":"/static/502c62def1d22c8851dd9e9b51e9bae4/9c36f/nuxtfetch.png 622w,\n/static/502c62def1d22c8851dd9e9b51e9bae4/2f9d0/nuxtfetch.png 1244w,\n/static/502c62def1d22c8851dd9e9b51e9bae4/1bb5f/nuxtfetch.png 2488w","sizes":"(min-width: 2488px) 2488px, 100vw"},"sources":[{"srcSet":"/static/502c62def1d22c8851dd9e9b51e9bae4/80ffa/nuxtfetch.webp 622w,\n/static/502c62def1d22c8851dd9e9b51e9bae4/c7d29/nuxtfetch.webp 1244w,\n/static/502c62def1d22c8851dd9e9b51e9bae4/c532c/nuxtfetch.webp 2488w","type":"image/webp","sizes":"(min-width: 2488px) 2488px, 100vw"}]},"width":2488,"height":3517}},"publicURL":"/static/502c62def1d22c8851dd9e9b51e9bae4/nuxtfetch.png"}}}}]}},"pageContext":{"slug":"/nuxtfetch/"}},"staticQueryHashes":[]}